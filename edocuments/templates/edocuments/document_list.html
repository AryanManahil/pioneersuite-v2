{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="max-w-5xl mx-auto mt-8 bg-white p-6 rounded-lg shadow-lg">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-semibold text-gray-800">eDocuments List</h1>
        {% if perms.edocuments.can_upload_document %}
        <a href="{% url 'edocuments:document_create' %}"
           class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow">
            + Create Document
        </a>
        {% endif %}
    </div>

    <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-300 rounded-lg overflow-hidden">
            <thead class="bg-gray-100">
            <tr class="text-left text-gray-700">
                <th class="px-4 py-3 border-b border-gray-300">#</th>
                <th class="px-4 py-3 border-b border-gray-300">Type</th>
                <th class="px-4 py-3 border-b border-gray-300">Submitted By</th>
                <th class="px-4 py-3 border-b border-gray-300">Note</th>
                <th class="px-4 py-3 border-b border-gray-300">Status</th>
                <th class="px-4 py-3 border-b border-gray-300">Attachment</th>
                {% if is_department_head %}
                <th class="px-4 py-3 border-b border-gray-300">Actions</th>
                {% endif %}
            </tr>
            </thead>
            <tbody>
            {% for doc in documents %}
            <tr class="text-gray-700 hover:bg-gray-50">
                <td class="border-b border-gray-300 px-4 py-3 text-center">{{ forloop.counter }}</td>
                <td class="border-b border-gray-300 px-4 py-3">{{ doc.get_document_type_display }}</td>
                <td class="border-b border-gray-300 px-4 py-3">
                    {{ doc.submitted_by.get_full_name|default:doc.submitted_by.email }}
                </td>
                <td class="border-b border-gray-300 px-4 py-3">
                    <div class="whitespace-pre-wrap text-sm leading-relaxed border rounded p-3 bg-gray-50 text-gray-800">
                        {{ doc.note|default:"No note provided." }}
                    </div>
                </td>
                <td class="border-b border-gray-300 px-4 py-3 text-center">
                    {% if doc.status == 'submitted' %}
                    <span class="inline-block bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-semibold capitalize">
                                {{ doc.status }}
                            </span>
                    {% elif doc.status == 'approved' %}
                    <span class="inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold capitalize">
                                {{ doc.status }}
                            </span>
                    {% elif doc.status == 'rejected' %}
                    <span class="inline-block bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-semibold capitalize">
                                {{ doc.status }}
                            </span>
                    {% else %}
                    <span class="inline-block bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-sm font-semibold capitalize">
                                {{ doc.status }}
                            </span>
                    {% endif %}
                </td>
                <td class="border-b border-gray-300 px-4 py-3 text-center">
                    <a href="{{ doc.attachment.url }}" target="_blank"
                       class="text-blue-600 underline hover:text-blue-800">
                        View
                    </a>
                </td>
                {% if is_department_head %}
                <td class="border-b border-gray-300 px-4 py-3 text-right space-x-2">
                    {% if doc.status == 'submitted' %}
                    <a href="{% url 'edocuments:document_approve' doc.pk %}"
                       class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded shadow text-sm font-semibold">
                        Approve
                    </a>
                    <a href="{% url 'edocuments:document_reject' doc.pk %}"
                       class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded shadow text-sm font-semibold">
                        Reject
                    </a>
                    {% else %}
                    <span class="text-gray-600 italic">Processed</span>
                    {% endif %}
                </td>
                {% endif %}

            </tr>
            {% empty %}
            <tr>
                <td colspan="{% if is_department_head %}7{% else %}6{% endif %}"
                    class="text-center text-gray-500 py-8">
                    No documents found.
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
